<div class="container-fluid py-4">
  <section class="bg-white rounded shadow-sm p-4 mb-4">
    <h2 class="mb-4">Portfolio Management</h2>

    <!-- Add Portfolio Form -->
    <form
      [formGroup]="portfolioForm"
      (ngSubmit)="uploadPortfolio()"
      class="mb-4"
    >
      <div class="mb-3">
        <label class="form-label">Main Image</label>
        <input
          type="file"
          class="form-control"
          (change)="onFileSelected($event)"
          accept="image/*"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Gallery Images</label>
        <div class="d-flex gap-2 mb-2">
          <input
            type="file"
            class="form-control"
            (change)="onSingleGalleryImageSelected($event)"
            accept="image/*"
          />
          <button
            class="btn btn-primary"
            (click)="addToGalleryQueue()"
            [disabled]="!tempGalleryImage"
          >
            Add to Gallery
          </button>
        </div>
        <div class="gallery-preview" *ngIf="tempGalleryImages.length">
          <h6 class="mb-2">Gallery Queue</h6>
          <div class="d-flex flex-wrap gap-2">
            <div
              class="position-relative"
              *ngFor="let image of tempGalleryImages; let i = index"
            >
              <img
                [src]="image.preview"
                class="gallery-thumb"
                style="
                  width: 60px;
                  height: 60px;
                  object-fit: cover;
                  border-radius: 4px;
                "
              />
              <button
                class="btn btn-danger btn-sm position-absolute top-0 end-0"
                style="
                  transform: translate(50%, -50%);
                  border-radius: 50%;
                  padding: 0.2rem 0.4rem;
                "
                (click)="removeTempImage(i)"
              >
                ×
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Title</label>
        <input
          type="text"
          class="form-control"
          formControlName="title"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Category</label>
        <select class="form-select" formControlName="category" required>
          <option value="">Select a category</option>
          <option value="branding">Branding</option>
          <option value="print">Print</option>
          <option value="digital">Digital</option>
          <option value="packaging">Packaging</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea
          class="form-control"
          rows="4"
          formControlName="description"
          required
        ></textarea>
      </div>

      <div class="mb-3">
        <label class="form-label">Client</label>
        <input
          type="text"
          class="form-control"
          formControlName="client"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Completion Date</label>
        <input
          type="date"
          class="form-control"
          formControlName="completionDate"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Tags (comma-separated)</label>
        <input
          type="text"
          class="form-control"
          formControlName="tags"
          placeholder="design, print, branding"
          required
        />
      </div>

      <button
        type="submit"
        class="btn btn-primary w-100"
        [disabled]="!portfolioForm.valid || !selectedFile"
      >
        Upload Portfolio Item
      </button>
    </form>

    <!-- Portfolio Items List -->
    <div class="row g-4">
      <div class="col-md-4" *ngFor="let item of portfolioItems" @fadeInOut>
        <!-- Portfolio View Mode -->
        <div class="card h-100" *ngIf="!item.isEditing" @slideInOut>
          <img [src]="item.imageUrl" class="card-img-top" [alt]="item.title" />
          <div class="card-body d-flex flex-column">
            <span class="badge bg-primary mb-2">{{ item.category }}</span>
            <h3 class="card-title h5">{{ item.title }}</h3>
            <p class="card-text">{{ item.description }}</p>
            <p class="mb-1"><strong>Client:</strong> {{ item.client }}</p>
            <p class="mb-3">
              <strong>Completed:</strong> {{ item.completionDate | date }}
            </p>
            <div class="tags mb-3">
              <span
                class="badge bg-secondary me-1"
                *ngFor="let tag of item.tags"
                >{{ tag }}</span
              >
            </div>
            <div class="gallery-preview mb-3" *ngIf="item.gallery?.length">
              <h6 class="mb-2">Gallery Images</h6>
              <div class="d-flex flex-wrap gap-2">
                <img
                  *ngFor="let image of item.gallery"
                  [src]="image"
                  class="gallery-thumb"
                  style="
                    width: 60px;
                    height: 60px;
                    object-fit: cover;
                    border-radius: 4px;
                  "
                />
              </div>
            </div>
            <div class="d-flex gap-2 mt-auto">
              <button
                class="btn btn-outline-primary flex-grow-1"
                (click)="item.isEditing = true"
              >
                Edit
              </button>
              <button
                class="btn btn-outline-danger flex-grow-1"
                (click)="deletePortfolio(item.id)"
              >
                Delete
              </button>
            </div>
          </div>
        </div>

        <!-- Portfolio Edit Mode -->
        <div class="card h-100" *ngIf="item.isEditing" @slideInOut>
          <div class="card-body">
            <select class="form-select mb-3" [(ngModel)]="item.category">
              <option value="branding">Branding</option>
              <option value="print">Print</option>
              <option value="digital">Digital</option>
              <option value="packaging">Packaging</option>
            </select>
            <input
              type="text"
              class="form-control mb-3"
              [(ngModel)]="item.title"
            />
            <textarea
              class="form-control mb-3"
              [(ngModel)]="item.description"
            ></textarea>
            <input
              type="text"
              class="form-control mb-3"
              [(ngModel)]="item.client"
            />
            <input
              type="date"
              class="form-control mb-3"
              [(ngModel)]="item.completionDate"
            />
            <input
              type="text"
              class="form-control mb-3"
              [(ngModel)]="item.tags"
            />

            <div class="gallery-section mb-3">
              <label class="form-label">Add to Gallery</label>
              <div class="d-flex gap-2 mb-2">
                <input
                  type="file"
                  class="form-control"
                  (change)="onSingleGalleryImageSelected($event)"
                  accept="image/*"
                />
                <button
                  class="btn btn-primary"
                  (click)="addToGalleryQueue()"
                  [disabled]="!tempGalleryImage"
                >
                  Add Image
                </button>
              </div>

              <div class="gallery-preview">
                <h6 class="mb-2">Current Gallery Images</h6>
                <div class="d-flex flex-wrap gap-2">
                  <div
                    class="position-relative"
                    *ngFor="let image of item.gallery; let i = index"
                  >
                    <img
                      [src]="image"
                      class="gallery-thumb"
                      style="
                        width: 60px;
                        height: 60px;
                        object-fit: cover;
                        border-radius: 4px;
                      "
                    />
                    <button
                      class="btn btn-danger btn-sm position-absolute top-0 end-0"
                      style="
                        transform: translate(50%, -50%);
                        border-radius: 50%;
                        padding: 0.2rem 0.4rem;
                      "
                      (click)="removeGalleryImage(item, i)"
                    >
                      ×
                    </button>
                  </div>

                  <div
                    class="position-relative"
                    *ngFor="let image of tempGalleryImages; let i = index"
                  >
                    <img
                      [src]="image.preview"
                      class="gallery-thumb"
                      style="
                        width: 60px;
                        height: 60px;
                        object-fit: cover;
                        border-radius: 4px;
                      "
                    />
                    <button
                      class="btn btn-danger btn-sm position-absolute top-0 end-0"
                      style="
                        transform: translate(50%, -50%);
                        border-radius: 50%;
                        padding: 0.2rem 0.4rem;
                      "
                      (click)="removeTempImage(i)"
                    >
                      ×
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="d-flex gap-2">
              <button
                class="btn btn-primary flex-grow-1"
                (click)="updatePortfolio(item)"
              >
                Save
              </button>
              <button
                class="btn btn-secondary flex-grow-1"
                (click)="item.isEditing = false"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
